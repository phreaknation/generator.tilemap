!function(){"use strict";var __seed,__perlin,__perlinFunction,__modulename="tilemap_generator",__pluginname="TilemapGenerator",__version=[0,0,1],__description="Generates a tilemap based on perlin noise.",__author="Joel Dies <phreaknation@gmail.com>",__gridSize={height:32,width:32},__tileSize={height:32,width:32},__schemas={},plugin=function(game,parent){return Phaser.Plugin.call(this,game,parent),"undefined"==typeof console.error&&(console.error=console.log),this.game=game,this.parent=parent,this.schemas=__schemas,this.tileRegistry=[],this.rotation=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],this};plugin.prototype=Object.create(Phaser.Plugin.prototype),plugin.prototype.constructor=Phaser.Plugin.SamplePlugin,plugin.prototype.description=function(){return _.toTitleCase(_.replace(__modulename,/\_/g," "))+" plugin by "+__author+". "+__description},plugin.prototype.generateGrid=function(xStart,yStart,callback,gridSize,seed){var x=0,grid=[],noise=this.getPerlinFunction();for(xStart=xStart||0,yStart=yStart||0,gridSize=gridSize||{height:this.getGridSize("height"),width:this.getGridSize("width")},seed=seed||__seed,x=0;x<parseFloat(gridSize.width);){for(var row=[],y=0;y<parseFloat(gridSize.height);){var xRand=(x+xStart+seed)/16,yRand=(y+yStart+seed)/16,rand=noise(xRand,yRand,0);_.isFunction(callback)&&row.push(callback(rand,x,y)),y++}x++,grid.push(row)}return grid},plugin.prototype.generateSeed=function(itr){var seeds=[],rnd=this.random();return itr=itr||1e3,_.times(itr,function(){var next=rnd.next();seeds.push(next)}),seeds[seeds.length-1]},plugin.prototype.getGridSize=function(d){return d=_.toLower(d)||"width",Object.keys(__gridSize).indexOf(d)!==-1&&__gridSize[d]},plugin.prototype.getPerlin=function(){return __perlin},plugin.prototype.getPerlinFunction=function(){return __perlinFunction},plugin.prototype.getSeed=function(){return __seed},plugin.prototype.getTileSize=function(d){return d=_.toLower(d)||"width",Object.keys(__tileSize).indexOf(d)!==-1&&__tileSize[d]},plugin.prototype.loadPerlin=function(perlin,seed){_.isUndefined(seed)||(seed=__seed),this.setSeed(seed),this.perlin=new perlin(this.getSeed())},plugin.prototype.mapRender=function(game,currX,currY,group){return this.tileRegistry=[],_.each(this.rotation,function(rot){var canRender,x,y;if(x=currX+rot[0]*this.getTileSize("width"),y=currY+rot[1]*this.getTileSize("height"),canRender=this.tileInCamera(game.camera,{x:x,y:y}))return this.TileRegistry.push({x:x,y:y})})},plugin.prototype.random=function(){var seed,constant=Math.pow(2,13)+1,prime=47417,maximum=1e3;return _.isNumber(__seed)&&(seed=__seed),null===seed&&(seed=this.seedRandom()),{next:function(min,max){for(;seed>constant;)seed/=prime;return seed*=constant,seed+=prime,void 0!==min&&void 0!==max?Math.floor(min+seed%maximum/maximum*(max-min)):seed%maximum/maximum}}},plugin.prototype.seedRandom=function(){var x=1e3*Math.sin(__seed++);return x-Math.floor(x)},plugin.prototype.setGridSize=function(width,height){return!!_.isNumber(width)&&(_.isUndefined(height)&&(height=width),__gridSize={height:height,width:width})},plugin.prototype.setPerlin=function(perlin,seed,overwriteSeed){var __funcname="setPerlin";if(_.isUndefined(seed)?seed=this.getSeed():overwriteSeed===!0&&this.setSeed(seed),_.isNumber(seed)){if(_.isFunction(perlin))return __perlin=new perlin(seed);console.error("[%s][%s] Perlin library must be a function.",__modulename,__funcname)}else console.error("[%s][%s] Seed has not been set. Please use the setSeed function, or pass it as a second parameter.",__modulename,__funcname);return!1},plugin.prototype.setPerlinFunction=function(func){var __funcname="setPerlin";return _.isFunction(func)?__perlinFunction=func:(console.error("[%s][%s] Function supplied is not a function.",__modulename,__funcname),!1)},plugin.prototype.setSeed=function(seed){return!!_.isNumber(seed)&&(__seed=seed)},plugin.prototype.setTileSize=function(width,height){return!!_.isNumber(width)&&(_.isUndefined(height)&&(height=width),__tileSize={height:height,width:width})},plugin.prototype.tileInCamera=function(camera,tilePos){var cameraTop,cameraRight,x,y,r,t;return!_.isUndefined(camera)&&(!_.isUndefined(tilePos)&&(x=tilePos.x,r=tilePos.x+this.getTileSize("width"),cameraRight=camera.x+camera.width,x>camera.x&&r<cameraRight&&(y=tilePos.y,t=tilePos.y+this.getTileSize("height"),cameraTop=camera.y+camera.height,y>camera.y&&t<cameraTop)&&-1!==_.findIndex(this.tileRegistry,function(tile,index){if(tile.x===x&&tile.y===y)return!0})))},plugin.prototype.version=function(){return __version.join(".")},window.PhreakNation=window.PhreakNation||{},window.PhreakNation.Plugins=window.PhreakNation.Plugins||{},window.PhreakNation.Plugins[__pluginname]=plugin}();